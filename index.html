  <!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>BLOCK GAMES</title>
  <link rel="manifest" href="manifest.json">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  body {
    margin: 0;
    background: #020824;
    color: white;
    font-family: sans-serif;
    overflow: hidden;
  }

  header {
    text-align: center;
    padding: 10px 0;
    font-weight: bold;
  }

  #gameScreen, #searchScreen {
    position: absolute;
    top: 40px;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #searchScreen {
    display: none;
    flex-direction: column;
  }

  canvas {
    background: black;
    touch-action: none;
  }

  input {
    width: 80%;
    max-width: 400px;
    padding: 12px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
  }
</style>
</head>

<body>
<div id="score">SCORE : 0</div>
<header>BLOCK GAMES</header>

<div id="gameScreen">
  <canvas id="game"></canvas>
</div>

<div id="searchScreen">
  <form action="https://duckduckgo.com/" method="GET">
    <input name="q" placeholder="Search…" autofocus>
  </form>
</div>

<script>
  let score = 0;
const scoreEl = document.getElementById("score");
/* ===== 5回タップで切り替え ===== */
let taps = 0;
document.addEventListener("click", () => {
  taps++;
  if (taps >= 5) {
    taps = 0;

    if (searchScreen.style.display === "flex") {
      // 検索 → ゲーム
      searchScreen.style.display = "none";
      gameScreen.style.display = "flex";
    } else {
      // ゲーム → 検索
      gameScreen.style.display = "none";
      searchScreen.style.display = "flex";
    }
  }
});

/* ===== Canvas ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - 40;
}
resize();
window.addEventListener("resize", resize);

/* ===== パドル ===== */
const paddle = {
  w: 100,
  h: 12,
  x: 0,
  y: 0
};

/* ===== ボール ===== */
const ball = {
  r: 6,
  x: 0,
  y: 0,
  vx: 5,
  vy: -5
};

/* ===== ブロック ===== */
const rows = 5;
const cols = 8;
const blockH = 16;
const gap = 6;
let blockW;
let blocks = [];

function initBlocks() {
  blocks = [];
  blockW = (canvas.width - gap * (cols + 1)) / cols;
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      blocks.push({
        x: gap + c * (blockW + gap),
        y: 20 + r * (blockH + gap),
        alive: true
      });
    }
  }
}

/* ===== リセット ===== */
function reset() {
  paddle.x = (canvas.width - paddle.w) / 2;
  paddle.y = canvas.height - 30;
  ball.x = canvas.width / 2;
  ball.y = canvas.height - 60;
  ball.vx = 5;
  ball.vy = -5;
  initBlocks();
}
reset();

/* ===== 操作 ===== */
canvas.addEventListener("touchmove", e => {
  const rect = canvas.getBoundingClientRect();
  paddle.x = e.touches[0].clientX - rect.left - paddle.w / 2;
});

/* ===== 描画 ===== */
function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // パドル
  ctx.fillStyle = "white";
  ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

  // ボール
  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fill();

  // ブロック
  ctx.fillStyle = "#4aa3ff";
  blocks.forEach(b => {
    if (b.alive) ctx.fillRect(b.x, b.y, blockW, blockH);
  });
}

/* ===== 更新 ===== */
function update() {
  ball.x += ball.vx;
  ball.y += ball.vy;

  if (ball.x < ball.r || ball.x > canvas.width - ball.r) ball.vx *= -1;
  if (ball.y < ball.r) ball.vy *= -1;

  if (
    ball.y + ball.r > paddle.y &&
    ball.x > paddle.x &&
    ball.x < paddle.x + paddle.w
  ) ball.vy *= -1;

  blocks.forEach(b => {
    if (b.alive &&
        ball.x > b.x && ball.x < b.x + blockW &&
        ball.y > b.y && ball.y < b.y + blockH) {
      b.alive = false;
      ball.vy *= -1;
      addScore(10);
    }
  });

  if (ball.y > canvas.height) reset();
}

/* ===== ループ ===== */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
