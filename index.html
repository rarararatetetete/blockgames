<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>BLOCK GAMES</title>

<style>
body {
  margin: 0;
  background: #0b1a33;
  color: white;
  font-family: system-ui;
  overflow: hidden;
}
header {
  height: 60px;
  background: #09162c;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}
#logo {
  font-weight: bold;
  font-size: 20px;
}
#hiscore { position:absolute; left:10px; top:5px; }
#stage { position:absolute; left:10px; top:30px; }
#life { position:absolute; right:10px; top:5px; }
#score { position:absolute; right:10px; top:30px; }
#settingsBtn {
  position:absolute;
  right:50%;
  top:5px;
  transform: translateX(140px);
}
canvas { display:block; }

#settings, #search {
  position:fixed;
  inset:0;
  background:#000c;
  display:none;
  z-index:10;
}
.panel {
  background:#112;
  padding:20px;
  margin:40px;
  border-radius:12px;
}
button { font-size:16px; }
</style>
</head>

<body>

<header>
  <div id="logo">BLOCK GAMES</div>
  <div id="hiscore">HI: 0</div>
  <div id="stage">STAGE 1</div>
  <div id="life">❤️❤️❤️❤️❤️</div>
  <div id="score">SCORE 0</div>
  <button id="settingsBtn">⚙️</button>
</header>

<canvas id="game"></canvas>

<div id="settings">
  <div class="panel">
    <h2>設定</h2>
    BGM <input type="range" id="bgmVol" min="0" max="1" step="0.01"><br><br>
    SE <input type="range" id="seVol" min="0" max="1" step="0.01"><br><br>
    <button onclick="closeSettings()">閉じる</button>
  </div>
</div>

<div id="search">
  <div class="panel">
    <button onclick="closeSearch()">← 戻る</button>
    <iframe src="https://duckduckgo.com" style="width:100%;height:80vh;border:none;"></iframe>
  </div>
</div>

<script>
/* ========= 基本設定 ========= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const headerH = 60;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight - headerH;
}
resize();
addEventListener("resize", resize);

/* ========= 状態 ========= */
let stage = 1;
let score = 0;
let hi = Number(localStorage.getItem("hi")||0);
let life = 5;
document.getElementById("hiscore").textContent = "HI: "+hi;

/* ========= ロゴ5タップ ========= */
let tap = 0;
logo.onclick = ()=>{
  tap++;
  if(tap>=5){ openSearch(); tap=0; }
};

/* ========= サウンド ========= */
const bgm = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_8bdf5f3f9c.mp3");
bgm.loop=true;
bgm.volume=0.3;
bgm.play();

const se = new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_64c97b8c0b.mp3");

bgmVol.oninput=e=>bgm.volume=e.target.value;
seVol.oninput=e=>se.volume=e.target.value;

/* ========= ゲーム物体 ========= */
let balls=[{x:200,y:300,vx:4,vy:-4}];
let paddle={x:150,w:100};
let blocks=[];

function makeBlocks(){
  blocks=[];
  const rows=5;
  const cols=7;
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      blocks.push({
        x:c*(canvas.width/cols),
        y:r*30+20,
        w:canvas.width/cols-4,
        h:20,
        color:`hsl(${Math.random()*360},100%,60%)`
      });
    }
  }
}
makeBlocks();

/* ========= メインループ ========= */
function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // paddle
  ctx.fillStyle="white";
  ctx.fillRect(paddle.x,canvas.height-20,paddle.w,10);

  // balls
  balls.forEach(b=>{
    b.x+=b.vx; b.y+=b.vy;
    if(b.x<0||b.x>canvas.width) b.vx*=-1;
    if(b.y<0) b.vy*=-1;
    if(b.y>canvas.height){
      life--;
      balls=[{x:200,y:300,vx:4,vy:-4}];
      if(life<=0){ stage=1; score=0; life=5; }
    }
    ctx.beginPath();
    ctx.arc(b.x,b.y,6,0,Math.PI*2);
    ctx.fill();
  });

  // blocks
  blocks.forEach((bl,i)=>{
    ctx.fillStyle=bl.color;
    ctx.fillRect(bl.x,bl.y,bl.w,bl.h);
    balls.forEach(b=>{
      if(b.x>bl.x&&b.x<bl.x+bl.w&&b.y>bl.y&&b.y<bl.y+bl.h){
        blocks.splice(i,1);
        b.vy*=-1;
        score+=100;
        se.currentTime=0; se.play();
      }
    });
  });

  if(blocks.length===0){
    stage++;
    makeBlocks();
  }

  document.getElementById("score").textContent="SCORE "+score;
  document.getElementById("stage").textContent="STAGE "+stage;
  document.getElementById("life").textContent="❤️".repeat(life);
  hi=Math.max(hi,score);
  localStorage.setItem("hi",hi);
  document.getElementById("hiscore").textContent="HI: "+hi;

  requestAnimationFrame(loop);
}
loop();

/* ========= 操作 ========= */
addEventListener("mousemove",e=>{
  paddle.x=e.clientX-paddle.w/2;
});
addEventListener("touchmove",e=>{
  paddle.x=e.touches[0].clientX-paddle.w/2;
});

/* ========= 設定・検索 ========= */
settingsBtn.onclick=()=>settings.style.display="block";
function closeSettings(){settings.style.display="none";}
function openSearch(){search.style.display="block";}
function closeSearch(){search.style.display="none";}
</script>

</body>
</html>
