<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLOCK GAMES</title>

<style>
body {
  margin: 0;
  background: #020824;
  color: white;
  font-family: sans-serif;
  overflow: hidden;
}
header {
  height: 70px;
  background: #020824;
  display: flex;
  flex-direction: column;
  justify-content: center;
  position: relative;
}
#topRow, #bottomRow {
  display: flex;
  justify-content: space-between;
  padding: 0 10px;
  font-size: 14px;
}
#logo {
  text-align: center;
  font-weight: bold;
  font-size: 18px;
}
canvas {
  display: block;
}
#fireworks, #credits {
  position: fixed;
  inset: 0;
  pointer-events: none;
}
#credits {
  display: none;
  background: black;
  color: white;
  text-align: center;
  font-size: 18px;
}
#creditsContent {
  position: absolute;
  bottom: -100%;
  width: 100%;
  line-height: 2;
}
</style>
</head>

<body>

<header>
  <div id="topRow">
    <span id="hiscore">HI: 0</span>
    <span id="life">❤️❤️❤️❤️❤️</span>
    <span id="score">SCORE: 0</span>
  </div>
  <div id="logo">BLOCK GAMES</div>
  <div id="bottomRow">
    <span id="stage">STAGE 1</span>
  </div>
</header>

<canvas id="game"></canvas>
<canvas id="fireworks"></canvas>

<div id="credits">
  <div id="creditsContent">
    <h2>STAFF ROLL</h2>
    <p>――――――――――</p>

    <p><strong>企画</strong><br>Yさん</p>
    <p>「とりあえず作ってみよ」</p>

    <p><strong>メインプログラム</strong><br>ChatGPT</p>
    <p>「やりすぎなくらい本気」</p>

    <p><strong>デザイン</strong><br>Yさん × ChatGPT</p>
    <p>深夜テンション共同制作</p>

    <p><strong>テストプレイ</strong><br>Yさん</p>
    <p>無言で何度も死亡</p>

    <p><strong>ボス調整</strong><br>ChatGPT</p>
    <p>「これくらいでいいでしょ」<br>→ 全然よくなかった</p>

    <p><strong>Special Thanks</strong><br>あなた</p>
    <p>ここまで遊んでくれてありがとう</p>

    <p style="margin-top:60px;font-size:24px;">THE END</p>
    <p style="margin-top:40px;">画面タップで最初から</p>
  </div>
</div>

<script>
/* ===== CANVAS ===== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const fx = document.getElementById("fireworks");
const fctx = fx.getContext("2d");
const headerH = 70;

function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight - headerH;
  fx.width = innerWidth;
  fx.height = innerHeight;
}
resize(); addEventListener("resize", resize);

/* ===== DATA ===== */
let stage = 101; // ★テスト用：最初からボス戦
let score = 0;
let hiScore = Number(localStorage.hiScore || 0);
let life = 5;

/* ===== UI ===== */
const scoreEl = document.getElementById("score");
const hiEl = document.getElementById("hiscore");
const stageEl = document.getElementById("stage");
const lifeEl = document.getElementById("life");

/* ===== BALL ===== */
let balls=[{x:0,y:0,vx:6,vy:-6,r:6}];

/* ===== PADDLE ===== */
const paddle = { w:100,h:12,x:0,y:0 };
function resetPaddle(){
  paddle.x = (canvas.width - paddle.w) / 2;
  paddle.y = canvas.height - 20;
}
resetPaddle();

/* ===== BOSS ===== */
let boss={
  x:canvas.width/2-80,
  y:80,
  w:160,
  h:40,
  hp:30,
  vx:5
};

/* ===== FIREWORK ===== */
function firework(big){
  for(let i=0;i<(big?200:60);i++){
    fctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
    fctx.beginPath();
    fctx.arc(
      Math.random()*fx.width,
      Math.random()*fx.height/2,
      Math.random()*3+1,
      0,Math.PI*2
    );
    fctx.fill();
  }
  setTimeout(()=>fctx.clearRect(0,0,fx.width,fx.height),800);
}

/* ===== TOUCH ===== */
canvas.addEventListener("touchmove",e=>{
  paddle.x=e.touches[0].clientX-paddle.w/2;
});

/* ===== LOOP ===== */
function update(){
  balls.forEach(ball=>{
    ball.x+=ball.vx;
    ball.y+=ball.vy;

    if(ball.x<ball.r||ball.x>canvas.width-ball.r) ball.vx*=-1;
    if(ball.y<ball.r) ball.vy*=-1;

    if(ball.y+ball.r>paddle.y&&ball.x>paddle.x&&ball.x<paddle.x+paddle.w){
      ball.vy=-Math.abs(ball.vy);
    }

    if(ball.x>boss.x&&ball.x<boss.x+boss.w&&ball.y>boss.y&&ball.y<boss.y+boss.h){
      boss.hp--;
      ball.vy*=-1;
    }
  });

  boss.x+=boss.vx;
  if(boss.x<0||boss.x+boss.w>canvas.width) boss.vx*=-1;

  if(boss.hp<=0){
    firework(true);
    setTimeout(showCredits, 1200);
    cancelAnimationFrame(loopId);
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="white";
  ctx.fillRect(paddle.x,paddle.y,paddle.w,paddle.h);

  balls.forEach(b=>{
    ctx.beginPath();
    ctx.arc(b.x,b.y,b.r,0,Math.PI*2);
    ctx.fill();
  });

  ctx.fillStyle="red";
  ctx.fillRect(boss.x,boss.y,boss.w,boss.h);
  ctx.fillText("BOSS HP: "+boss.hp,boss.x,boss.y-6);

  stageEl.textContent="STAGE 101";
}

let loopId;
function loop(){
  update();
  draw();
  loopId=requestAnimationFrame(loop);
}
loop();

/* ===== STAFF ROLL ===== */
function showCredits(){
  document.getElementById("credits").style.display="block";
  const c=document.getElementById("creditsContent");
  let pos=-innerHeight;
  function scroll(){
    pos+=0.5;
    c.style.bottom=pos+"px";
    if(pos<innerHeight*2) requestAnimationFrame(scroll);
  }
  scroll();

  document.getElementById("credits").addEventListener("click",()=>{
    location.reload();
  });
}
</script>

</body>
</html>
