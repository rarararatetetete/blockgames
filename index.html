<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>BLOCK GAMES</title>

<style>
:root{--theme:#0b1a33}
*{box-sizing:border-box}
body{margin:0;background:var(--theme);color:#fff;font-family:system-ui;overflow:hidden}
button{background:none;border:none;color:#fff;font-size:16px}
.hidden{display:none}

/* ===== UI ===== */
header{
 height:64px;background:#09162c;
 display:grid;grid-template-columns:1fr auto 1fr;
 align-items:center;padding:0 10px
}
#logo{font-weight:900;font-size:20px;letter-spacing:2px}
#life{font-size:18px}
canvas{display:block}

/* ===== overlays ===== */
.overlay{
 position:fixed;inset:0;background:#000c;
 display:none;z-index:10;
 align-items:center;justify-content:center
}
.panel{
 background:#112;padding:20px;border-radius:16px;
 width:min(90vw,320px)
}
#title{
 display:flex;flex-direction:column;gap:20px;
 align-items:center;justify-content:center
}
#title h1{
 font-size:32px;
 animation:glow 2s infinite alternate
}
@keyframes glow{
 from{text-shadow:0 0 5px #0ff}
 to{text-shadow:0 0 20px #0ff}
}
</style>
</head>

<body>

<header>
 <div id="left">
  <div id="hiscore">HI 0</div>
  <div id="stageLabel">STAGE 1</div>
 </div>
 <div id="center">
  <div id="logo">BLOCK GAMES</div>
 </div>
 <div id="right">
  <button id="settingsBtn">⚙️</button>
  <div id="life">❤️❤️❤️❤️❤️</div>
  <div id="score">0</div>
 </div>
</header>

<canvas id="game"></canvas>

<!-- ===== TITLE ===== -->
<div id="title" class="overlay" style="display:flex">
 <h1>BLOCK GAMES</h1>
 <button onclick="startGame()">▶ START</button>
 <button onclick="openSettings()">⚙️ SETTINGS</button>
</div>

<!-- ===== SEARCH ===== -->
<div id="search" class="overlay">
 <div class="panel">
  <button onclick="closeSearch()">←</button>
  <input id="q" placeholder="DuckDuckGo検索" style="width:100%;padding:10px">
  <button onclick="searchDDG()" style="width:100%;margin-top:10px">検索</button>
 </div>
</div>

<!-- ===== SETTINGS ===== -->
<div id="settings" class="overlay">
 <div class="panel">
  <h3>設定</h3>
  BGM <input id="bgmVol" type="range" min="0" max="1" step="0.01"><br>
  SE <input id="seVol" type="range" min="0" max="1" step="0.01"><br><br>
  テーマ色 <input type="color" id="themePick"><br><br>
  <button onclick="closeSettings()">閉じる</button>
 </div>
</div>

<script>
/* ===== CANVAS ===== */
const canvas=game,ctx=canvas.getContext("2d");
const H=64;
function resize(){
 canvas.width=innerWidth;
 canvas.height=innerHeight-H
}
resize();addEventListener("resize",resize);

/* ===== AUDIO ===== */
const AC=window.AudioContext||webkitAudioContext;
const ac=new AC();
function tone(f,t=0.1){
 const o=ac.createOscillator(),g=ac.createGain();
 o.frequency.value=f;
 o.connect(g);g.connect(ac.destination);
 g.gain.value=0.2;
 o.start();o.stop(ac.currentTime+t);
}

/* ===== STATE ===== */
let stage=1,score=0,life=5;
let hi=+localStorage.hi||0;
hiscore.textContent="HI "+hi;

let paddle={x:200,w:100};
let balls=[],blocks=[];
let speed=6;

/* ===== LOGO 5 TAP ===== */
let tap=0;
logo.onclick=()=>{
 if(++tap>=5){openSearch();tap=0}
};

/* ===== GAME SETUP ===== */
function setBalls(n=1){
 balls=[];
 for(let i=0;i<n;i++)
  balls.push({
   x:canvas.width/2,y:300,
   vx:(Math.random()*2-1)*speed,
   vy:-speed
  });
}
function makeBlocks(){
 blocks=[];
 for(let i=0;i<20;i++)
  blocks.push({
   x:Math.random()*(canvas.width-60),
   y:Math.random()*200+40,
   w:60,h:20,
   c:`hsl(${Math.random()*360},100%,60%)`
  });
}
function reset(){
 speed=6+stage*0.2;
 const b=stage>=76?3:stage>=50?2:1;
 setBalls(b);makeBlocks();
}

/* ===== MAIN LOOP ===== */
function loop(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 ctx.fillStyle="#fff";
 ctx.fillRect(paddle.x,canvas.height-20,paddle.w,10);

 balls.forEach((b,bi)=>{
  b.x+=b.vx;b.y+=b.vy;
  if(b.x<0||b.x>canvas.width) b.vx*=-1;
  if(b.y<0) b.vy*=-1;

  if(b.y+6>canvas.height-20 &&
     b.x>paddle.x&&b.x<paddle.x+paddle.w){
   b.vy=-Math.abs(b.vy);tone(600)
  }

  if(b.y>canvas.height){
   balls.splice(bi,1);
   life--;tone(200);
   life.textContent="❤️".repeat(life);
   if(life<=0){
    stage=1;score=0;life=5;
    reset();
   }
  }

  ctx.beginPath();
  ctx.arc(b.x,b.y,6,0,Math.PI*2);
  ctx.fill();
 });

 blocks.forEach((bl,i)=>{
  ctx.fillStyle=bl.c;
  ctx.fillRect(bl.x,bl.y,bl.w,bl.h);
  balls.forEach(b=>{
   if(b.x>bl.x&&b.x<bl.x+bl.w&&
      b.y>bl.y&&b.y<bl.y+bl.h){
    blocks.splice(i,1);
    b.vy*=-1;
    score+=100;tone(800);
   }
  });
 });

 if(blocks.length===0){
  stage++;tone(1200,0.3);
  reset();
 }

 score.textContent=score;
 stageLabel.textContent="STAGE "+stage;
 hi=Math.max(hi,score);
 localStorage.hi=hi;
 hiscore.textContent="HI "+hi;

 requestAnimationFrame(loop);
}

/* ===== CONTROL ===== */
addEventListener("mousemove",e=>paddle.x=e.clientX-paddle.w/2);
addEventListener("touchmove",e=>{
 paddle.x=e.touches[0].clientX-paddle.w/2
});

/* ===== UI ===== */
function startGame(){
 title.style.display="none";
 reset();loop();
}
function openSettings(){settings.style.display="flex"}
function closeSettings(){settings.style.display="none"}
function openSearch(){search.style.display="flex"}
function closeSearch(){search.style.display="none"}
function searchDDG(){
 const q=document.getElementById("q").value;
 if(q)window.open("https://duckduckgo.com/?q="+encodeURIComponent(q));
}
themePick.oninput=e=>{
 document.documentElement.style.setProperty("--theme",e.target.value);
 localStorage.theme=e.target.value;
}
if(localStorage.theme)
 document.documentElement.style.setProperty("--theme",localStorage.theme);
</script>

</body>
</html>
