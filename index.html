  <!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BLOCK GAMES</title>

<style>
body {
  margin: 0;
  background: #020824;
  color: white;
  overflow: hidden;
  font-family: sans-serif;
}

header {
  height: 60px;
  line-height: 60px;
  text-align: center;
  font-weight: bold;
  background: #020824;
  position: relative;
  user-select: none;
}

#score, #hiscore {
  position: absolute;
  top: 0;
  font-size: 14px;
}

#score { right: 12px; }
#hiscore { left: 12px; }

canvas {
  display: block;
  background: #020824;
}

#clear {
  position: fixed;
  inset: 0;
  background: rgba(2,8,36,0.85);
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 10;
}

#clear h1 {
  font-size: 32px;
}

#clear button {
  margin-top: 20px;
  padding: 10px 20px;
  background: none;
  border: 1px solid white;
  color: white;
  border-radius: 8px;
}
</style>
</head>

<body>
<header id="logo">
  BLOCK GAMES
  <span id="hiscore">HI: 0</span>
  <span id="score">SCORE: 0</span>
</header>

<canvas id="gameCanvas"></canvas>

<div id="clear">
  <h1>CLEAR!</h1>
  <button onclick="restart()">もう一回</button>
</div>

<script>
/* ===== Canvas ===== */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const headerHeight = 60;

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight - headerHeight;
  resetPaddle();
}
window.addEventListener("resize", resize);

/* ===== スコア ===== */
let score = 0;
let hiScore = Number(localStorage.getItem("hiScore")) || 0;
const scoreEl = document.getElementById("score");
const hiScoreEl = document.getElementById("hiscore");

function updateScore() {
  scoreEl.textContent = "SCORE: " + score;
  if (score > hiScore) {
    hiScore = score;
    localStorage.setItem("hiScore", hiScore);
    hiScoreEl.textContent = "HI: " + hiScore;
  }
}

/* ===== Audio ===== */
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

/* 効果音 */
function popSound() {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.frequency.value = 600;
  gain.gain.value = 0.08;
  osc.connect(gain).connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + 0.05);
}

/* BGM（リラックス系） */
let bgmOsc, bgmGain;
function startBGM() {
  if (bgmOsc) return;
  bgmOsc = audioCtx.createOscillator();
  bgmGain = audioCtx.createGain();
  bgmOsc.type = "sine";
  bgmOsc.frequency.value = 220;
  bgmGain.gain.value = 0.03;
  bgmOsc.connect(bgmGain).connect(audioCtx.destination);
  bgmOsc.start();

  setInterval(() => {
    bgmOsc.frequency.setValueAtTime(
      180 + Math.random() * 80,
      audioCtx.currentTime
    );
  }, 3000);
}

/* ===== 難易度 ===== */
let speed = 4;
function updateDifficulty() {
  if (score >= 8000) speed = 7;
  else if (score >= 5000) speed = 6;
  else if (score >= 3000) speed = 5.5;
  else if (score >= 1000) speed = 5;
  else speed = 4;

  ball.vx = Math.sign(ball.vx) * speed;
  ball.vy = Math.sign(ball.vy) * speed;
}

/* ===== パドル ===== */
const paddle = { w: 100, h: 12, x: 0, y: 0 };
function resetPaddle() {
  paddle.x = (canvas.width - paddle.w) / 2;
  paddle.y = canvas.height - paddle.h - 10;
}

/* ===== ボール ===== */
const ball = { r: 6, x: 0, y: 0, vx: speed, vy: -speed };
function resetBall() {
  ball.x = canvas.width / 2;
  ball.y = canvas.height / 2;
  ball.vx = speed * (Math.random() > 0.5 ? 1 : -1);
  ball.vy = -speed;
}

/* ===== ブロック（虹色） ===== */
const blocks = [];
const rows = 5;
const cols = 7;
const blockHeight = 20;

function createBlocks() {
  blocks.length = 0;
  const bw = canvas.width / cols;
  for (let r = 0; r < rows; r++) {
    const hue = (r / rows) * 360;
    for (let c = 0; c < cols; c++) {
      blocks.push({
        x: c * bw,
        y: r * blockHeight + 30,
        w: bw - 2,
        h: blockHeight - 2,
        alive: true,
        color: `hsl(${hue}, 80%, 60%)`
      });
    }
  }
}

/* ===== 花火 ===== */
const fireworks = [];
function launchFirework() {
  for (let i = 0; i < 120; i++) {
    fireworks.push({
      x: canvas.width / 2,
      y: canvas.height / 2,
      vx: (Math.random() - 0.5) * 8,
      vy: (Math.random() - 0.5) * 8,
      life: 60
    });
  }
}

/* ===== 操作 ===== */
canvas.addEventListener("touchstart", () => startBGM(), { once: true });
canvas.addEventListener("touchmove", e => {
  paddle.x = e.touches[0].clientX - paddle.w / 2;
  paddle.x = Math.max(0, Math.min(canvas.width - paddle.w, paddle.x));
});

/* ===== ゲーム ===== */
let cleared = false;

function update() {
  if (cleared) return;

  ball.x += ball.vx;
  ball.y += ball.vy;

  if (ball.x < ball.r || ball.x > canvas.width - ball.r) ball.vx *= -1;
  if (ball.y < ball.r) ball.vy *= -1;

  if (
    ball.y + ball.r > paddle.y &&
    ball.x > paddle.x &&
    ball.x < paddle.x + paddle.w
  ) {
    ball.vy = -Math.abs(ball.vy);
  }

  blocks.forEach(b => {
    if (!b.alive) return;
    if (
      ball.x > b.x &&
      ball.x < b.x + b.w &&
      ball.y - ball.r < b.y + b.h &&
      ball.y + ball.r > b.y
    ) {
      b.alive = false;
      ball.vy *= -1;
      score += 10;
      popSound();
      updateDifficulty();
      updateScore();
    }
  });

  if (score >= 10000) {
    cleared = true;
    document.getElementById("clear").style.display = "flex";
    launchFirework();
  }

  if (ball.y > canvas.height) {
    score = 0;
    speed = 4;
    updateScore();
    resetBall();
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "white";
  ctx.fillRect(paddle.x, paddle.y, paddle.w, paddle.h);

  ctx.beginPath();
  ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI * 2);
  ctx.fill();

  blocks.forEach(b => {
    if (!b.alive) return;
    ctx.fillStyle = b.color;
    ctx.fillRect(b.x, b.y, b.w, b.h);
  });

  fireworks.forEach(f => {
    ctx.fillStyle = "white";
    ctx.fillRect(f.x, f.y, 2, 2);
    f.x += f.vx;
    f.y += f.vy;
    f.life--;
  });

  for (let i = fireworks.length - 1; i >= 0; i--) {
    if (fireworks[i].life <= 0) fireworks.splice(i, 1);
  }
}

function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

function restart() {
  score = 0;
  speed = 4;
  cleared = false;
  updateScore();
  createBlocks();
  resetBall();
  fireworks.length = 0;
  document.getElementById("clear").style.display = "none";
}

/* ===== 隠し検索 ===== */
let tapCount = 0;
let tapTimer = null;
document.getElementById("logo").addEventListener("click", () => {
  tapCount++;
  if (tapTimer) clearTimeout(tapTimer);
  tapTimer = setTimeout(() => tapCount = 0, 1500);
  if (tapCount === 5) location.href = "https://duckduckgo.com";
});

/* ===== start ===== */
hiScoreEl.textContent = "HI: " + hiScore;
resize();
createBlocks();
resetBall();
updateScore();
loop();
</script>
</body>
</html>
